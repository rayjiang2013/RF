<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="HL_API_Help.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Appendix|IxNetwork (only) Examples|TCL_Samples">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" /><title>L2TPoE (L2TPoE_LAC.tcl)</title>
        <script src="../../../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js" type="text/javascript">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js" type="text/javascript">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../HL_API_Help.htm#HLTAPI/HLTAPI Examples/IxNetwork (only) Examples/L2TPoE_LAC.htm">Open topic with navigation</a>
        </p>
        <h3><a name="0_pgfId-3552269"></a><a name="0_48941"></a>
          L2TPoE (L2TPoE_LAC.tcl)</h3>
        <p class="CodeBlock">          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549470"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549471"></a>
          # Description: #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549472"></a>
          # This sample configures 10 L2TP tunnels with 10 sessions each between the #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549473"></a>
          # first Ixia port and DUT. Traffic is sent between the two Ixia ports. #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549474"></a>
          # Topology is the following: #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549475"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549476"></a>
          # Access &#160;&#160;&#160;PPPoE &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;L2TPoE &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Destination #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549477"></a>
          # Network -------- LAC ---------- LNS(DUT) ----------- Network #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549478"></a>
          #(Ixia Port1) &#160;(Ixia Port1) &#160;&#160;&#160;&#160;(Cisco 7200) &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(Ixia Port1) #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549480"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549481"></a>
          # Module: #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549482"></a>
          # The sample was tested on a LM1000STXS4 module. #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549483"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549484"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549485"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549486"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549487"></a>
          # DUT configuration: #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549488"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549489"></a>
          # username cisco password 0 cisco</p>
        <p class="CodeBlock"><a name="0_pgfId-3549490"></a>
          # aaa new-model</p>
        <p class="CodeBlock"><a name="0_pgfId-3549491"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549492"></a>
          # aaa authentication login telnet enable</p>
        <p class="CodeBlock"><a name="0_pgfId-3549493"></a>
          # aaa authentication ppp default local</p>
        <p class="CodeBlock"><a name="0_pgfId-3549494"></a>
          # aaa session-id common</p>
        <p class="CodeBlock"><a name="0_pgfId-3549495"></a>
          # ip subnet-zero</p>
        <p class="CodeBlock"><a name="0_pgfId-3549496"></a>
          # no ip gratuitous-arps</p>
        <p class="CodeBlock"><a name="0_pgfId-3549497"></a>
          # no ip domain lookup</p>
        <p class="CodeBlock"><a name="0_pgfId-3549498"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549499"></a>
          # ip multicast-routing</p>
        <p class="CodeBlock"><a name="0_pgfId-3549500"></a>
          # ip cef</p>
        <p class="CodeBlock"><a name="0_pgfId-3549501"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549502"></a>
          # vpdn enable</p>
        <p class="CodeBlock"><a name="0_pgfId-3549503"></a>
          # vpdn ip udp ignore checksum</p>
        <p class="CodeBlock"><a name="0_pgfId-3549504"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549505"></a>
          # vpdn-group LNS</p>
        <p class="CodeBlock"><a name="0_pgfId-3549506"></a>
          # accept-dialin</p>
        <p class="CodeBlock"><a name="0_pgfId-3549507"></a>
          # protocol l2tp</p>
        <p class="CodeBlock"><a name="0_pgfId-3549508"></a>
          # virtual-template 1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549509"></a>
          # local name lac</p>
        <p class="CodeBlock"><a name="0_pgfId-3549510"></a>
          # l2tp tunnel password 0 cisco</p>
        <p class="CodeBlock"><a name="0_pgfId-3549511"></a>
          # l2tp tunnel timeout no-session 1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549512"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549513"></a>
          # bba-group pppoe global</p>
        <p class="CodeBlock"><a name="0_pgfId-3549514"></a>
          # virtual-template 1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549515"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549516"></a>
          # interface Loopback1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549517"></a>
          # ip address 54.0.0.1 255.255.255.0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549518"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549519"></a>
          # interface GigabitEthernet0/2</p>
        <p class="CodeBlock"><a name="0_pgfId-3549520"></a>
          # ip address 12.70.0.1 255.255.255.0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549521"></a>
          # no ip mroute-cache</p>
        <p class="CodeBlock"><a name="0_pgfId-3549522"></a>
          # duplex half</p>
        <p class="CodeBlock"><a name="0_pgfId-3549523"></a>
          # pppoe enable group global</p>
        <p class="CodeBlock"><a name="0_pgfId-3549524"></a>
          # no keepalive</p>
        <p class="CodeBlock"><a name="0_pgfId-3549525"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549526"></a>
          # interface GigabitEthernet0/3</p>
        <p class="CodeBlock"><a name="0_pgfId-3549527"></a>
          # ip address 12.80.0.1 255.255.255.0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549528"></a>
          # no ip mroute-cache</p>
        <p class="CodeBlock"><a name="0_pgfId-3549529"></a>
          # duplex half</p>
        <p class="CodeBlock"><a name="0_pgfId-3549530"></a>
          # no keepalive</p>
        <p class="CodeBlock"><a name="0_pgfId-3549531"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549532"></a>
          # interface Virtual-Template1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549533"></a>
          # mtu 1458</p>
        <p class="CodeBlock"><a name="0_pgfId-3549534"></a>
          # ip unnumbered Loopback1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549535"></a>
          # no logging event link-status</p>
        <p class="CodeBlock"><a name="0_pgfId-3549536"></a>
          # no snmp trap link-status</p>
        <p class="CodeBlock"><a name="0_pgfId-3549537"></a>
          # peer default ip address pool pool1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549538"></a>
          # no keepalive</p>
        <p class="CodeBlock"><a name="0_pgfId-3549539"></a>
          # ppp max-bad-auth 10</p>
        <p class="CodeBlock"><a name="0_pgfId-3549540"></a>
          # ppp mtu adaptive</p>
        <p class="CodeBlock"><a name="0_pgfId-3549541"></a>
          # ppp authentication chap pap</p>
        <p class="CodeBlock"><a name="0_pgfId-3549542"></a>
          # ppp timeout retry 15</p>
        <p class="CodeBlock"><a name="0_pgfId-3549543"></a>
          # ppp timeout authentication 15</p>
        <p class="CodeBlock"><a name="0_pgfId-3549544"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549545"></a>
          # ip local pool pool1 54.0.0.2 54.0.0.254</p>
        <p class="CodeBlock"><a name="0_pgfId-3549546"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549547"></a>
          # ip classless</p>
        <p class="CodeBlock"><a name="0_pgfId-3549548"></a>
          # no ip http server</p>
        <p class="CodeBlock"><a name="0_pgfId-3549549"></a>
          # </p>
        <p class="CodeBlock"><a name="0_pgfId-3549550"></a>
          # line vty 0 16</p>
        <p class="CodeBlock"><a name="0_pgfId-3549551"></a>
          # exec-timeout 0 0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549552"></a>
          # login authentication telnet</p>
        <p class="CodeBlock"><a name="0_pgfId-3549553"></a>
          # end</p>
        <p class="CodeBlock"><a name="0_pgfId-3549554"></a>
                                                                               #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549555"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549556"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549557"></a>
          set env(IXIA_VERSION) HLTSET43</p>
        <p class="CodeBlock"><a name="0_pgfId-3549558"></a>
          package require Ixia</p>
        <p class="CodeBlock"><a name="0_pgfId-3549559"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549560"></a>
          set test_name [info script]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549561"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549562"></a>
          set chassisIP 10.205.19.228</p>
        <p class="CodeBlock"><a name="0_pgfId-3549563"></a>
          set port_list [list 7/3 7/4]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549564"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549565"></a>
          set session_count 100</p>
        <p class="CodeBlock"><a name="0_pgfId-3549566"></a>
          set tunnel_count 10</p>
        <p class="CodeBlock"><a name="0_pgfId-3549567"></a>
          set sessions_per_tunnel [expr $session_count / $tunnel_count]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549568"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549569"></a>
          # Connect to the chassis, reset to factory defaults and take ownership #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549570"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549571"></a>
          set connect_status [::ixia::connect \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549572"></a>
                  -reset \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549573"></a>
                  -device $chassisIP \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549574"></a>
                  -port_list $port_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549575"></a>
                  -username ixiaApiUser ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549576"></a>
          if {[keylget connect_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549577"></a>
              return "FAIL - $test_name - [keylget connect_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549578"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549579"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549580"></a>
          set port_handle [list]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549581"></a>
          foreach port $port_list {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549582"></a>
              if {![catch {keylget connect_status port_handle.$chassisIP.$port} \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549583"></a>
                          temp_port]} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549584"></a>
                  lappend port_handle $temp_port</p>
        <p class="CodeBlock"><a name="0_pgfId-3549585"></a>
              }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549586"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549587"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549588"></a>
          set access_port [lindex $port_handle 0]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549589"></a>
          set network_port [lindex $port_handle 1]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549590"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549591"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549592"></a>
          # Configure access interfaces in the test</p>
        <p class="CodeBlock"><a name="0_pgfId-3549593"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549594"></a>
          set port_handle_list $access_port</p>
        <p class="CodeBlock"><a name="0_pgfId-3549595"></a>
          set intf_ip_addr_list ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549596"></a>
          set gateway_list ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549597"></a>
          set speed_list auto</p>
        <p class="CodeBlock"><a name="0_pgfId-3549598"></a>
          set duplex_list auto</p>
        <p class="CodeBlock"><a name="0_pgfId-3549599"></a>
          set auto_list 1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549600"></a>
          set phy_mode_list copper</p>
        <p class="CodeBlock"><a name="0_pgfId-3549601"></a>
          set netmask_list ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549602"></a>
          set src_mac_addr_list ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549603"></a>
          set interface_status [::ixia::interface_config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549604"></a>
                  -port_handle $port_handle_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549605"></a>
                  -mode config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549606"></a>
                  -speed $speed_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549607"></a>
                  -duplex $duplex_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549608"></a>
                  -phy_mode $phy_mode_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549609"></a>
                  -autonegotiation $auto_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549610"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549611"></a>
          if {[keylget interface_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549612"></a>
              return "FAIL - $test_name - [keylget interface_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549613"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549614"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549615"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549616"></a>
          # Configure network interface in the test</p>
        <p class="CodeBlock"><a name="0_pgfId-3549617"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549618"></a>
          set port_handle_list $network_port</p>
        <p class="CodeBlock"><a name="0_pgfId-3549619"></a>
          set intf_ip_addr_list 12.80.0.2</p>
        <p class="CodeBlock"><a name="0_pgfId-3549620"></a>
          set gateway_list 12.80.0.1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549621"></a>
          set speed_list auto</p>
        <p class="CodeBlock"><a name="0_pgfId-3549622"></a>
          set duplex_list auto</p>
        <p class="CodeBlock"><a name="0_pgfId-3549623"></a>
          set phy_mode_list copper</p>
        <p class="CodeBlock"><a name="0_pgfId-3549624"></a>
          set auto_list 1</p>
        <p class="CodeBlock"><a name="0_pgfId-3549625"></a>
          set netmask_list 255.255.255.0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549626"></a>
          set src_mac_addr_list 00cd.00cd.cdcd</p>
        <p class="CodeBlock"><a name="0_pgfId-3549627"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549628"></a>
          set interface_status [::ixia::interface_config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549629"></a>
                  -port_handle $port_handle_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549630"></a>
                  -mode config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549631"></a>
                  -speed $speed_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549632"></a>
                  -duplex $duplex_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549633"></a>
                  -phy_mode $phy_mode_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549634"></a>
                  -autonegotiation $auto_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549635"></a>
                  -intf_ip_addr $intf_ip_addr_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549636"></a>
                  -gateway $gateway_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549637"></a>
                  -netmask $netmask_list \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549638"></a>
                  -src_mac_addr $src_mac_addr_list]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549639"></a>
          if {[keylget interface_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549640"></a>
              return "FAIL - $test_name - [keylget interface_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549641"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549642"></a>
          set int_handle [keylget interface_status interface_handle]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549643"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549644"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549645"></a>
          # Configure L2TP on the access port #</p>
        <p class="CodeBlock"><a name="0_pgfId-3549646"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549647"></a>
          set l2tp_status [::ixia::l2tp_config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549648"></a>
                  -port_handle $access_port \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549649"></a>
                  -mode lac \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549650"></a>
                  -l2_encap ethernet_ii \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549651"></a>
                  -num_tunnels $tunnel_count \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549652"></a>
                  -sessions_per_tunnel $sessions_per_tunnel \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549653"></a>
                  -l2tp_src_addr 12.70.0.2 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549654"></a>
                  -l2tp_dst_addr 12.70.0.1 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549655"></a>
                  -l2tp_src_count $tunnel_count \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549656"></a>
                  -l2tp_src_step 0.0.0.1 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549657"></a>
                  -l2tp_dst_step 0.0.0.0 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549658"></a>
                  -tun_distribution next_tunnelfill_tunnel \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549659"></a>
                  -attempt_rate 100 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549660"></a>
                  -tun_auth \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549661"></a>
                  -hostname lac \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549662"></a>
                  -secret cisco \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549663"></a>
                  -auth_mode chap \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549664"></a>
                  -username cisco \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549665"></a>
                  -password cisco \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549666"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549667"></a>
          if {[keylget l2tp_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549668"></a>
              return "FAIL - $test_name - [keylget l2tp_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549669"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549670"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549671"></a>
          set l2tp_handle [keylget l2tp_status handle]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549672"></a>
          puts "L2TP handle is $l2tp_handle "</p>
        <p class="CodeBlock"><a name="0_pgfId-3549673"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549674"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549675"></a>
          # Connect sessions</p>
        <p class="CodeBlock"><a name="0_pgfId-3549676"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549677"></a>
          set control_status [::ixia::l2tp_control \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549678"></a>
                  -handle $l2tp_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549679"></a>
                  -action connect ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549680"></a>
          if {[keylget control_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549681"></a>
              return "FAIL - $test_name - [keylget control_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549682"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549683"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549684"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549685"></a>
          # Get L2TP session/tunnel aggregate statistics</p>
        <p class="CodeBlock"><a name="0_pgfId-3549686"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549687"></a>
          puts "Waiting for sessions and tunnels to establish ..."</p>
        <p class="CodeBlock"><a name="0_pgfId-3549688"></a>
          set l2tp_attempts 0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549689"></a>
          set l2tp_tunnels_up 0</p>
        <p class="CodeBlock"><a name="0_pgfId-3549690"></a>
          while {($l2tp_tunnels_up &lt; $session_count)} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549691"></a>
              after 10000</p>
        <p class="CodeBlock"><a name="0_pgfId-3549692"></a>
              set l2tp_status [::ixia::l2tp_stats \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549693"></a>
                      -handle $l2tp_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549694"></a>
                      -mode aggregate ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549695"></a>
              if {[keylget l2tp_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549696"></a>
                  return "FAIL - $test_name - [keylget l2tp_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549697"></a>
              }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549698"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549699"></a>
              set aggregate_stats [keylget l2tp_status $access_port.aggregate]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549700"></a>
              set l2tp_tunnels_up [keylget aggregate_stats sessions_up]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549701"></a>
              incr l2tp_attempts</p>
        <p class="CodeBlock"><a name="0_pgfId-3549702"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549703"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549704"></a>
          set statList {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549705"></a>
              idle</p>
        <p class="CodeBlock"><a name="0_pgfId-3549706"></a>
              connecting</p>
        <p class="CodeBlock"><a name="0_pgfId-3549707"></a>
              num_sessions</p>
        <p class="CodeBlock"><a name="0_pgfId-3549708"></a>
              connected</p>
        <p class="CodeBlock"><a name="0_pgfId-3549709"></a>
              connect_success</p>
        <p class="CodeBlock"><a name="0_pgfId-3549710"></a>
              sessions_up</p>
        <p class="CodeBlock"><a name="0_pgfId-3549711"></a>
              tunnels_up</p>
        <p class="CodeBlock"><a name="0_pgfId-3549712"></a>
              tunnels_neg</p>
        <p class="CodeBlock"><a name="0_pgfId-3549713"></a>
              success_setup_rate</p>
        <p class="CodeBlock"><a name="0_pgfId-3549714"></a>
              min_setup_time</p>
        <p class="CodeBlock"><a name="0_pgfId-3549715"></a>
              max_setup_time</p>
        <p class="CodeBlock"><a name="0_pgfId-3549716"></a>
              avg_setup_time</p>
        <p class="CodeBlock"><a name="0_pgfId-3549717"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549718"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549719"></a>
          puts "\n"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549720"></a>
          puts [format "%-41s" "[string repeat * 14] L2TPoE STATS [string repeat * 13]"]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549721"></a>
          puts ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549722"></a>
          puts [format "%-30s %-10s" Statistic Value]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549723"></a>
          puts [format "%-41s" [string repeat "-" 41]]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549724"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549725"></a>
          foreach {key} $statList {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549726"></a>
              if {![catch {keylget aggregate_stats $key}]} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549727"></a>
                  puts [format "%-30s | %-10d" $key [keylget aggregate_stats $key]]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549728"></a>
              }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549729"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549730"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549731"></a>
          # Configure bidirectional traffic</p>
        <p class="CodeBlock"><a name="0_pgfId-3549732"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549733"></a>
          set traffic_status [::ixia::traffic_config \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549734"></a>
                  -mode create \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549735"></a>
                  -traffic_generator ixnetwork \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549736"></a>
                  -bidirectional 1 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549737"></a>
                  -emulation_src_handle $l2tp_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549738"></a>
                  -emulation_dst_handle $int_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549739"></a>
                  -track_by endpoint_pair \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549740"></a>
                  -l3_protocol ipv4 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549741"></a>
                  -frame_size 1014 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549742"></a>
                  -rate_percent 20 \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549743"></a>
                  -transmit_mode continuous \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549744"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549745"></a>
          if {[keylget traffic_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549746"></a>
              return "FAIL - $test_name - [keylget traffic_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549747"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549748"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549749"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549750"></a>
          # Clear traffic stats</p>
        <p class="CodeBlock"><a name="0_pgfId-3549751"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549752"></a>
          set control_status [::ixia::traffic_control \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549753"></a>
                  -port_handle $port_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549754"></a>
                  -action clear_stats \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549755"></a>
                  -traffic_generator ixnetwork \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549756"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549757"></a>
          if {[keylget control_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549758"></a>
              return "FAIL - $test_name - [keylget control_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549759"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549760"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549761"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549762"></a>
          # Start traffic </p>
        <p class="CodeBlock"><a name="0_pgfId-3549763"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549764"></a>
          set control_status [::ixia::traffic_control \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549765"></a>
                  -port_handle $port_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549766"></a>
                  -action run \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549767"></a>
                  -traffic_generator ixnetwork \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549768"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549769"></a>
          if {[keylget control_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549770"></a>
              return "FAIL - $test_name - [keylget control_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549771"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549772"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549773"></a>
          after 60000</p>
        <p class="CodeBlock"><a name="0_pgfId-3549774"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549775"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549776"></a>
          # Stop traffic</p>
        <p class="CodeBlock"><a name="0_pgfId-3549777"></a>
          ################################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549778"></a>
          set control_status [::ixia::traffic_control \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549779"></a>
                  -port_handle $port_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549780"></a>
                  -action stop \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549781"></a>
                  -traffic_generator ixnetwork \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549782"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549783"></a>
          if {[keylget control_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549784"></a>
              return "FAIL - $test_name - [keylget control_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549785"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549786"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549787"></a>
          ###############################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549788"></a>
          # Retrieve aggregate stats after traffic stopped</p>
        <p class="CodeBlock"><a name="0_pgfId-3549789"></a>
          ###############################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549790"></a>
          set aggregate_stats [::ixia::traffic_stats \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549791"></a>
                  -mode aggregate \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549792"></a>
                  -port_handle $port_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549793"></a>
                  -traffic_generator ixnetwork \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549794"></a>
                  ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549795"></a>
          if {[keylget aggregate_stats status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549796"></a>
              return "FAIL - $test_name - [keylget aggregate_stats log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549797"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549798"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549799"></a>
          proc post_stats {port_handle label key_list stat_key {stream ""}} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549800"></a>
              puts -nonewline [format "%-16s" $label]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549801"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549802"></a>
              foreach port $port_handle {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549803"></a>
                  if {$stream != ""} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549804"></a>
                      set key $port.stream.$stream.$stat_key</p>
        <p class="CodeBlock"><a name="0_pgfId-3549805"></a>
                  } else {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549806"></a>
                      set key $port.$stat_key</p>
        <p class="CodeBlock"><a name="0_pgfId-3549807"></a>
                  }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549808"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549809"></a>
                  puts -nonewline "[format "%-16s" [keylget key_list $key]]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549810"></a>
              }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549811"></a>
              puts ""</p>
        <p class="CodeBlock"><a name="0_pgfId-3549812"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549813"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549814"></a>
          puts "\n******************* TX/RX STATS **********************"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549815"></a>
          puts "\t\t$access_port\t\t$network_port"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549816"></a>
          puts "\t\t-----\t\t-----"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549817"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549818"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549819"></a>
          post_stats $port_handle "Packets Tx" $aggregate_stats aggregate.tx.pkt_count</p>
        <p class="CodeBlock"><a name="0_pgfId-3549820"></a>
          post_stats $port_handle "Bytes Tx" $aggregate_stats aggregate.tx.pkt_byte_count</p>
        <p class="CodeBlock"><a name="0_pgfId-3549821"></a>
          post_stats $port_handle "Packets Rx" $aggregate_stats aggregate.rx.pkt_count</p>
        <p class="CodeBlock"><a name="0_pgfId-3549822"></a>
          post_stats $port_handle "Collisions" $aggregate_stats aggregate.rx.collisions_count</p>
        <p class="CodeBlock"><a name="0_pgfId-3549823"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549824"></a>
          puts "******************************************************\n"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549825"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549826"></a>
          ############################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549827"></a>
          # Disconnect sessions</p>
        <p class="CodeBlock"><a name="0_pgfId-3549828"></a>
          ############################################################################</p>
        <p class="CodeBlock"><a name="0_pgfId-3549829"></a>
          puts "Disconnecting sessions ... "</p>
        <p class="CodeBlock"><a name="0_pgfId-3549830"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549831"></a>
          set control_status [::ixia::pppox_control \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549832"></a>
                  -handle $l2tp_handle \</p>
        <p class="CodeBlock"><a name="0_pgfId-3549833"></a>
                  -action disconnect ]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549834"></a>
          if {[keylget control_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549835"></a>
              return "FAIL - $test_name - [keylget control_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549836"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549837"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549838"></a>
          set cleanup_status [::ixia::cleanup_session -port_handle $port_handle -reset]</p>
        <p class="CodeBlock"><a name="0_pgfId-3549839"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549840"></a>
          if {[keylget cleanup_status status] != $::SUCCESS} {</p>
        <p class="CodeBlock"><a name="0_pgfId-3549841"></a>
              return "FAIL - $test_name - [keylget cleanup_status log]"</p>
        <p class="CodeBlock"><a name="0_pgfId-3549842"></a>
          }</p>
        <p class="CodeBlock"><a name="0_pgfId-3549843"></a> <![CDATA[ ]]></p>
        <p class="CodeBlock"><a name="0_pgfId-3549844"></a>
          return "SUCCESS - $test_name - [clock format [clock seconds]]"</p>
    </body>
</html>